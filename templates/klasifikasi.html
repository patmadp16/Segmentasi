{% extends "layout.html" %}

{% block contents %}

<div class="container">
    <h1 class="jumbotron bg-primary">Image Classfication</h1>
    <br><br>
    <form class="form-horizontal" action="/submit" method="post" enctype="multipart/form-data">
  
      <div class="form-group">
        <label class="control-label col-sm-2" for="pwd">Upload Your Image :</label>
        <div class="col-sm-10">          
          <input type="file" class="form-control" placeholder="Hours Studied"  name="my_image" id="pwd">
        </div>
      </div>
  
      <div class="form-group">        
        <div class="col-sm-offset-2 col-sm-10">
          <button type="submit" class="btn btn-success">Submit</button>
        </div>
      </div>
    </form>
  
      {% if prediction %}
    <img src="{{img_path}}" height="100px" width="100px">
          <p>Predicted Class: {{prediction}}</p>
          <p>Confidence: {{ confidence }}%</p>
      {% endif %}
  
  </div>

<!---
<script>

    $("#divFormHasil").hide();

    function setImg(){
        var citraInput = document.querySelector("#txtFileFoto");
        var preview = document.querySelector("#filePicPrev");
        var fileGambar = new FileReader();
        fileGambar.readAsDataURL(citraInput.files[0]);
        fileGambar.onload = function(e){
            let hasil = e.target.result;
            preview.src = hasil;
        }
        console.log("image ready to upload");
    }

    function startKlasifikasiProsesAtc()
    {
        let fileAwal = "https://nos.jkt-1.neo.id/aditiastorage/asset/ilustrasi/Formula-bro.png"
        let gambar = document.getElementById("filePicPrev").getAttribute("src");
        
        if(gambar === fileAwal){
            pesanUmumApp("warning", "Kesalahan", "File uji belum dipilih ... !!!");
        }else{
            confirmQuest("info", "Konfirmasi", "Mulai proses klasifikasi? ... ", function (x) {klasifikasiConfirm()});
        }
    }

    function klasifikasiConfirm()
    {   
        let gambar = document.getElementById("filePicPrev").getAttribute("src");
        let ds = {"gambar":gambar}
        document.querySelector("#divFormUji").innerHTML = "<h4>Memproses data uji untuk klasifikasi ... </h4>";
        $("#btnProsesKlasifikasi").hide();
        setTimeout(function(){
            $.post("{{ BASE_URL }}/proses-klasifikasi", ds, function(data){
                pesanUmumApp("success", "Success", "Proses klasifikasi selesai ... !!!");
                let hasil = data.hasil;
                let confidence = hasil['confidence'];
                //let fConfidence = confidence.
                let kelas = hasil['class'];
                $("#divFormUji").hide();
                document.querySelector("#capHasilPrediksiJenisBunga").innerHTML = kelas;
                document.querySelector("#capHasilConfidence").innerHTML = confidence+" %";
                $("#divFormHasil").show();
            });
        }, 3000); 
        
    }
</script>

{% endblock contents %}
